<?xml version="1.0" encoding="UTF-8"?>
<!-- entity-mappings xmlns="http://java.sun.com/xml/ns/persistence/orm"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm orm_1_0.xsd"
               version="1.0"-->               
<entity-mappings xmlns="http://java.sun.com/xml/ns/persistence/orm" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm orm_2_0.xsd" version="2.0">

<named-query name="TasksAssignedByProcessIdAndStatus">
	<query>
		select
  count(*)
from
    TaskImpl t 
    left join t.subjects as subject
    left join t.descriptions as description
    left join t.names as name
where
    t.archived = 0 and
    t.taskData.processId = :processId and 
    (
    name.language = :language
    or t.names.size = 0
    )
    and
    (
    subject.language = :language
    or t.subjects.size = 0
    ) 
    and
    (
    description.language = :language
    or t.descriptions.size = 0
    ) and
    t.taskData.status in (:status)
	</query>
</named-query>

                                                            
<named-query name="TasksAssignedCountAsPotentialOwnerByStatusWithGroups">
          <query>
select
  count(*)
from
    TaskImpl t 
    left join t.taskData.createdBy as createdBy
    left join t.taskData.actualOwner as actualOwner
    left join t.subjects as subject
    left join t.descriptions as description
    left join t.names as name,
    OrganizationalEntityImpl potentialOwners
where
    t.archived = 0 and
    ( potentialOwners.id = :userId or potentialOwners.id in (:groupIds) ) and
    potentialOwners in elements ( t.peopleAssignments.potentialOwners )  and

    (
    name.language = :language
    or t.names.size = 0
    ) and

    (
    subject.language = :language
    or t.subjects.size = 0
    ) and

    (
    description.language = :language
    or t.descriptions.size = 0
    ) and

    t.taskData.status in (:status) and

    t.taskData.expirationTime is null
          </query>
          <!-- hint name="org.hibernate.timeout" value="200"/ -->
      </named-query>
 
     <named-query name="TasksOwnedCount">
          <query>
select
  count(*)
from
    TaskImpl t 
    left join t.taskData.createdBy as createdBy
    left join t.taskData.actualOwner as actualOwner 
    left join t.subjects as subject
    left join t.descriptions as description
    left join t.names as name
where
    t.archived = 0 and
    t.taskData.actualOwner.id = :userId and

    (
    name.language = :language
    or t.names.size = 0
    ) and

    (
    subject.language = :language
    or t.subjects.size = 0
    ) and

    (
    description.language = :language
    or t.descriptions.size = 0
    ) and
    
	t.taskData.status in (:status) and
	
    t.taskData.expirationTime is null
          </query>
          <!-- hint name="org.hibernate.timeout" value="200"/ -->
      </named-query>
      
        <named-query name="TasksOwnedBySubject">
          <query>
select
   distinct
   new org.jbpm.services.task.query.TaskSummaryImpl(
    t.id,
    name.text,
    description.text,
    t.taskData.status,
    t.priority,
    t.taskData.actualOwner.id,
    t.taskData.createdBy.id,
    t.taskData.createdOn,
    t.taskData.activationTime,
    t.taskData.expirationTime,
    t.taskData.processId,
    t.taskData.processInstanceId,
    t.taskData.parentId,
    t.taskData.deploymentId)
from
    TaskImpl t 
    left join t.subjects as subject
    left join t.descriptions as description
    left join t.names as name,
    OrganizationalEntityImpl potentialOwners
where
    t.archived = 0 and
    (t.taskData.actualOwner.id = :userId
    or 
    	( potentialOwners.id = :userId or potentialOwners.id in (:groupIds) ) and
    	potentialOwners in elements ( t.peopleAssignments.potentialOwners )
    )
    
     and

    (
    name.language = :language
    or t.names.size = 0
    ) and

    (
    subject.language = :language
    or t.subjects.size = 0
    ) and

    (
    description.language = :language
    or t.descriptions.size = 0
    )and 
    t.taskData.processInstanceId = :processInstanceId
    and
    t.taskData.expirationTime is null
          </query>
          <!-- hint name="org.hibernate.timeout" value="200"/ -->
      </named-query>
      
      <named-query name="TaskAssignedAsBizAdministrator">
          <query>
select
   distinct
   new org.jbpm.services.task.query.TaskSummaryImpl(
    t.id,
    name.text,
    description.text,
    t.taskData.status,
    t.priority,
    t.taskData.actualOwner.id,
    t.taskData.createdBy.id,
    t.taskData.createdOn,
    t.taskData.activationTime,
    t.taskData.expirationTime,
    t.taskData.processId,
    t.taskData.processInstanceId,
    t.taskData.parentId,
    t.taskData.deploymentId)
from
    TaskImpl t 
    left join t.subjects as subject
    left join t.descriptions as description
    left join t.names as name,
    OrganizationalEntityImpl businessAdministrators
where
    t.archived = 0 and
    ( businessAdministrators.id = :userId)
        
     and

    (
    name.language = :language
    or t.names.size = 0
    ) and

    (
    subject.language = :language
    or t.subjects.size = 0
    ) and

    (
    description.language = :language
    or t.descriptions.size = 0
    )and 
    t.taskData.processInstanceId = :processInstanceId
    and
    t.taskData.expirationTime is null
          </query>
          <!-- hint name="org.hibernate.timeout" value="200"/ -->
      </named-query>
      
      
      <named-query name="TasksOwnedIds">
          <query>
select
  t.id
from
    TaskImpl t 
    left join t.taskData.actualOwner as actualOwner 
    left join t.subjects as subject
    left join t.descriptions as description
    left join t.names as name
where
    t.archived = 0 and
    t.taskData.actualOwner.id = :userId and

    (
    name.language = :language
    or t.names.size = 0
    ) and

    (
    subject.language = :language
    or t.subjects.size = 0
    ) and

    (
    description.language = :language
    or t.descriptions.size = 0
    ) and
    
	t.taskData.status in (:status) and
	
    t.taskData.expirationTime is null
          </query>
          <!-- hint name="org.hibernate.timeout" value="200"/ -->
      </named-query>
      
 <named-query name="TasksUnassignedCount">
          <query>
select
  count(*)
from
    TaskImpl t 
    left join t.taskData.createdBy as createdBy
    left join t.taskData.actualOwner as actualOwner
    left join t.subjects as subject
    left join t.descriptions as description
    left join t.names as name
where
    t.archived = 0 and
    ( t.taskData.actualOwner is null ) and
    t.peopleAssignments.potentialOwners is empty  and

    (
    name.language = :language
    or t.names.size = 0
    ) and

    (
    subject.language = :language
    or t.subjects.size = 0
    ) and

    (
    description.language = :language
    or t.descriptions.size = 0
    ) and

    t.taskData.status in (:status) and

    t.taskData.expirationTime is null
          </query>
          <!-- hint name="org.hibernate.timeout" value="200"/ -->
      </named-query>
 
 <named-query name="TasksAssignedCountAsPotentialOwner_ByStatus_WithGroups_PerTask">
          <query>
select
  t.name,count(*)
from
    TaskImpl t 
    left join t.taskData.createdBy as createdBy
    left join t.taskData.actualOwner as actualOwner
    left join t.subjects as subject
    left join t.descriptions as description,
    OrganizationalEntityImpl potentialOwners
where
    t.archived = 0 and
    t.taskData.processId=:processId and
    ( potentialOwners.id = :userId or potentialOwners.id in (:groupIds) ) and
    potentialOwners in elements ( t.peopleAssignments.potentialOwners )  and
    t.taskData.status in (:status) and
    t.taskData.expirationTime is null 
    group by t.name
    
          </query>
          <!-- hint name="org.hibernate.timeout" value="200"/ -->
      </named-query>

<named-query name="TasksCount_ByStatus_PerTask">
          <query>
select
  t.name,count(*)
from
    TaskImpl t 
where
    t.archived = 0 and
    t.taskData.processId=:processId and
    t.taskData.status in (:status) and
    t.taskData.expirationTime is null 
    group by t.name
    
          </query>
          <!-- hint name="org.hibernate.timeout" value="200"/ -->
      </named-query>

</entity-mappings>